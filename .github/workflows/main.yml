name: sync-all-txt-to-v2

on:
  schedule:
    - cron: '0 */1 * * *'  # 每 6 小时运行一次
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout your repository
        uses: actions/checkout@v4

      - name: wd.txt #本地稳定节点
        run: |
          git clone https://github.com/CCXUEHUI/tb.git repo
          
      - name: Clone source repository 2
        run: |
          git clone https://github.com/major-118/subscriptions.git repo1

      - name: Clear v2.txt before appending
        run: |
          > v2.txt

      - name: wd.txt
        run: |
          find repo -name "wd.md" -exec cat {} + >> v2.txt

      - name: Append all *.txt files from repo1
        run: |
          find repo1 -name "*.txt" -exec cat {} + >> v2.txt

      - name: Set Git identity
        run: |
          git config --global user.name "${{ github.repository_owner }}"
          git config --global user.email "${{ github.repository_owner }}@users.noreply.github.com"

      - name: Commit and push v2.txt
        run: |
          git add v2.txt
          git commit -m "Auto-sync v2.txt"
          git push
